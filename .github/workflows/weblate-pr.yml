name: Weblate Translation PR

on:
  push:
    branches:
      - weblate

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout weblate branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: weblate

      - name: Fetch all branches
        run: |
          git fetch --all
          git branch -a

      - name: Check for differences
        id: check-diff
        run: |
          # Show what commits are in weblate but not in master
          echo "Commits in weblate not in master:"
          git log origin/master..HEAD --oneline || echo "No unique commits"

          # Check if there are actual file differences
          if git diff --quiet origin/master HEAD; then
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "âœ… No file changes detected between weblate and master"
          else
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "ğŸ“ File changes detected:"
            git diff --stat origin/master HEAD
          fi

      - name: Create or update pull request
        if: steps.check-diff.outputs.has_changes == 'true'
        uses: repo-sync/pull-request@v2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          source_branch: weblate
          destination_branch: master
          pr_title: "ğŸŒ Translation updates from Weblate"
          pr_body: |
            ## Translation Updates from Weblate

            This PR contains the latest translation updates automatically synced from Weblate.

            ### Changes
            - Automatically synced from Weblate platform
            - Contains updates to translation files

            ### Review Checklist
            - [ ] Translation changes look correct
            - [ ] No unexpected file modifications
            - [ ] Ready to merge

            ---
            ğŸ“ **Note**: This PR is automatically updated when new translations are pushed from Weblate.

            ğŸ¤– *Auto-generated by GitHub Actions*
          pr_label: "translations,weblate,i18n"
          pr_assignee: "eliakassoufshelvz"
          pr_allow_empty: false

      - name: Success - No changes needed
        if: steps.check-diff.outputs.has_changes == 'false'
        run: |
          echo "âœ… Workflow completed successfully!"
          echo "â„¹ï¸  Branches are in sync - no PR needed"
